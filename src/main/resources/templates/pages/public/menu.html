<!doctype html>
<html lang="sr" xmlns:th="http://www.thymeleaf.org" th:with="pageTitle='Meni - Naša Ponuda'">
<head th:replace="~{layouts/base :: head}"></head>
<body>

<div th:replace="~{layouts/base :: navbar}"></div>

<section class="hero-section mini-hero p-5">
    <div class="hero-overlay"></div>
    <div class="hero-content">
        <div class="container text-center text-white">
            <h1 class="display-5 fw-bold mb-2" th:text="${heroTitle}"></h1>
            <p class="lead mb-0" th:text="${heroSubtitle}"></p>
        </div>
    </div>
</section>
<div class="catalog-container">
    <div class="container">
        <div class="row">
            <div class="col-lg-3">
                <div class="filter-sidebar">
                    <div class="filter-header">
                        <i class="bi bi-funnel"></i>
                        <h4>Filteri</h4>
                    </div>

                    <div class="filter-section">
                        <h5>
                            <i class="bi bi-bookmark"></i>
                            Tip Proizvoda
                        </h5>
                        <div class="filter-option">
                            <input type="checkbox" id="filter-slatko" name="type" th:value="${sweet}" checked>
                            <label for="filter-slatko">Slatko</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="filter-slano" name="type" th:value="${salty}" checked>
                            <label for="filter-slano">Slano</label>
                        </div>
                    </div>

                    <hr class="filter-divider">

                    <div class="filter-section">
                        <h5>
                            <i class="bi bi-calendar-event"></i>
                            Vrsta Proslave
                        </h5>
                        <div class="filter-option">
                            <input type="radio" id="filter-sve" name="occasion" th:value="${all}" checked>
                            <label for="filter-sve">Sve proslave</label>
                        </div>
                        <div class="filter-option">
                            <input type="radio" id="filter-vencanje" name="occasion" th:value="${wedding}" >
                            <label for="filter-vencanje">Venčanje</label>
                        </div>
                        <div class="filter-option">
                            <input type="radio" id="filter-rodjendani" name="occasion" th:value="${birthday}">
                            <label for="filter-rodjendani">Rođendan</label>
                        </div>
                        <div class="filter-option">
                            <input type="radio" id="filter-korporativni" name="occasion" th:value="${company}">
                            <label for="filter-korporativni">Korporativni događaji</label>
                        </div>
                        <div class="filter-option">
                            <input type="radio" id="filter-privatno" name="occasion" th:value="${private}">
                            <label for="filter-privatno">Privatne proslave</label>
                        </div>
                    </div>

                    <hr class="filter-divider">

                    <div class="filter-section">
                        <h5>
                            <i class="bi bi-currency-exchange"></i>
                            Cenovni Opseg
                        </h5>
                        <div class="filter-option">
                            <input type="checkbox" id="filter-price1" name="price" value="0-5000">
                            <label for="filter-price1">Do 5.000 RSD</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="filter-price2" name="price" value="5000-10000">
                            <label for="filter-price2">5.000 - 10.000 RSD</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="filter-price3" name="price" value="10000+">
                            <label for="filter-price3">Preko 10.000 RSD</label>
                        </div>
                    </div>

                    <hr class="filter-divider">

                    <button class="btn-clear-filters" onclick="clearFilters()">
                        <i class="bi bi-x-circle me-2"></i>
                        Poništi filtere
                    </button>
                </div>
            </div>

            <div class="col-lg-9">
                <div class="products-header">
                    <div class="products-count">
                        <div class="pagination-info">
                            Prikazano
                            <strong th:text="${products.size()}"></strong>
                            od
                            <strong th:text="${totalItems}"></strong>
                            proizvoda
                        </div>
                    </div>
                    <select class="sort-select" id="sort-select" onchange="sortProducts()">
                        <option value="default">Sortiraj po</option>
                        <option value="price-asc">Cena: Najniža</option>
                        <option value="price-desc">Cena: Najviša</option>
                        <option value="name-asc">Ime: A-Z</option>
                        <option value="name-desc">Ime: Z-A</option>
                    </select>
                </div>


                <div class="row g-4" id="products-grid">

                        <div id="productData" th:each="product : ${products}"  class="col-lg-4 col-md-6 product-item"
                             th:attr="data-type=${product.productType},
                                      data-occasion=${product.eventType},
                                      data-price=${product.price}
                                      ">

                            <div class="product-card">
                                <div class="product-image">
                                    <span th:class="'product-badge ' + (${product.quantity > 10} ? 'badge-new' : 'badge-popular')">
                                        <span th:text="${product.quantity > 10 ? 'Na stanju' : 'Skoro rasprodato'}"></span>
                                    </span>
                                    <img th:src="@{'/uploads/' + ${product.imagePath}}" alt="Torta">
                                    <div class="product-quick-view">
                                        <button class="btn-quick-view">
                                            <i class="bi bi-eye"></i> Brzi pregled
                                        </button>
                                    </div>
                                </div>
                                <div class="product-body">
                                    <span class="product-category" th:text="${product.productType.displayName}"></span>
                                    <h3 class="product-title" th:text="${product.name}"></h3>
                                    <p class="product-description" th:text="${product.description}"></p>
                                    <div class="product-meta">
                                        <span class="product-reviews" th:text="${product.servings + ' po porciji'}"></span>
                                    </div>
                                    <div class="product-footer">
                                        <div class="product-price" th:text="${#numbers.formatDecimal(product.price, 0, 'POINT', 0, 'COMMA') + ' RSD'}"></div>
                                        <button class="btn-add-cart"
                                                th:attr="data-type=${product.productType},
                                                data-occasion=${product.eventType},
                                                data-price=${product.price},
                                                data-product-id=${product.id},
                                                data-name=${product.name}"
                                                >
                                            <i class="bi bi-cart-plus"></i>

                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>



                    <div class="pagination-container" th:if="${products != null && !products.isEmpty()}">
                        <div class="pagination-info">
                            Prikazano
                            <strong th:text="${products.size()}"></strong>
                            od
                            <strong th:text="${totalItems}"></strong>
                            proizvoda
                        </div>

                        <div class="pagination-controls">
                            <a th:href="@{/public/menu(page=${currentPage - 1}, pageSize=${pageSize})}"
                               th:classappend="${currentPage == 1 ? 'disabled' : ''}"
                               class="pagination-btn"
                               th:disabled="${currentPage == 1}">
                                <i class="bi bi-chevron-left"></i>
                            </a>

                            <th:block th:each="i : ${#numbers.sequence(1, totalPages)}">
                                <a th:if="${i == 1}"
                                   th:href="@{/public/menu(page=${i}, pageSize=${pageSize})}"
                                   th:classappend="${currentPage == i ? 'active' : ''}"
                                   class="pagination-btn"
                                   th:text="${i}">1</a>

                                <span th:if="${i == 2 && currentPage > 3}" class="pagination-btn disabled">...</span>

                                <a th:if="${i > 1 && i < totalPages && i >= currentPage - 1 && i <= currentPage + 1}"
                                   th:href="@{/public/menu(page=${i}, pageSize=${pageSize})}"
                                   th:classappend="${currentPage == i ? 'active' : ''}"
                                   class="pagination-btn"
                                   th:text="${i}">2</a>

                                <span th:if="${i == totalPages - 1 && currentPage < totalPages - 2}" class="pagination-btn disabled">...</span>

                                <a th:if="${i == totalPages && totalPages > 1}"
                                   th:href="@{/public/menu(page=${i}, pageSize=${pageSize})}"
                                   th:classappend="${currentPage == i ? 'active' : ''}"
                                   class="pagination-btn"
                                   th:text="${i}">5</a>
                            </th:block>

                            <a th:href="@{/public/menu(page=${currentPage + 1}, pageSize=${pageSize})}"
                               th:classappend="${currentPage == totalPages ? 'disabled' : ''}"
                               class="pagination-btn"
                               th:disabled="${currentPage == totalPages}">
                                <i class="bi bi-chevron-right"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div th:replace="~{layouts/base :: footer}"></div>

<div th:replace="~{layouts/base :: scripts}"></div>

<script>


    function filterProducts() {
        const typeFilters = Array.from(document.querySelectorAll('input[name="type"]:checked')).map(el => el.value);
        const occasionInput = document.querySelector('input[name="occasion"]:checked');
        const occasionFilter = occasionInput ? occasionInput.value : 'ALL';
        const priceFilters = Array.from(document.querySelectorAll('input[name="price"]:checked')).map(el => el.value);

        const products = document.querySelectorAll('.product-item');
        let visibleCount = 0;

        products.forEach(product => {
            const productType = product.dataset.type;
            const productOccasion = product.dataset.occasion;
            const productPrice = parseInt(product.dataset.price);

            const typeMatch = typeFilters.length === 0 || typeFilters.includes(productType);
            const occasionMatch = occasionFilter === 'ALL' || productOccasion === occasionFilter;

            let priceMatch = true;
            if (priceFilters.length > 0) {
                priceMatch = priceFilters.some(range => {
                    if (range === '0-5000') return productPrice <= 5000;
                    if (range === '5000-10000') return productPrice > 5000 && productPrice <= 10000;
                    if (range === '10000+') return productPrice > 10000;
                    return false;
                });
            }

            if (typeMatch && occasionMatch && priceMatch) {
                product.style.display = 'block';
                visibleCount++;
            } else {
                product.style.display = 'none';
            }
        });

        document.getElementById('shown-count').textContent = visibleCount.toString();
    }

    document.querySelectorAll('input[name="type"], input[name="occasion"], input[name="price"]').forEach(input => {
        input.addEventListener('change', filterProducts);
    });

    function sortProducts() {
        const sortValue = document.getElementById('sort-select').value;
        const grid = document.getElementById('products-grid');
        const products = Array.from(grid.querySelectorAll('.product-item'));

        products.sort((a, b) => {
            switch(sortValue) {
                case 'price-asc':
                    return parseInt(a.dataset.price) - parseInt(b.dataset.price);
                case 'price-desc':
                    return parseInt(b.dataset.price) - parseInt(a.dataset.price);
                case 'name-asc':
                    return a.querySelector('.product-title').textContent.localeCompare(b.querySelector('.product-title').textContent);
                case 'name-desc':
                    return b.querySelector('.product-title').textContent.localeCompare(a.querySelector('.product-title').textContent);
                default:
                    return 0;
            }
        });

        products.forEach(product => grid.appendChild(product));
    }

    function clearFilters() {
        document.querySelectorAll('input[name="type"]').forEach(el => el.checked = true);
        document.querySelector('input[value="ALL"]').checked = true;
        document.querySelectorAll('input[name="price"]').forEach(el => el.checked = false);
        filterProducts();
    }

    document.querySelectorAll('input[name="type"], input[name="occasion"], input[name="price"]').forEach(input => {
        input.addEventListener('change', filterProducts);
    });
</script>

</body>
</html>