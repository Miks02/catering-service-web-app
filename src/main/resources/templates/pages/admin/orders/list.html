<!DOCTYPE html>
<html lang="sr" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head th:replace="~{layouts/admin :: head}"></head>
<body>

<div class="admin-wrapper">
    <aside th:replace="~{layouts/admin :: adminSidebar}"></aside>

    <div class="admin-content">
        <header class="admin-topbar">
            <button type="button" class="topbar-mobile-toggle" id="mobileToggle">
                <i class="bi bi-list"></i>
            </button>

            <h1 class="topbar-title">
                <i class="bi-bing"></i>
                Porudžbine
            </h1>

            <div class="topbar-actions">
                <a th:href="@{/public}" class="topbar-btn btn-site">
                    <i class="bi bi-globe"></i>
                    <span>Sajt</span>
                </a>

                <div class="topbar-user">
                    <div class="topbar-user-avatar">
                        <i class="bi bi-person-fill"></i>
                    </div>
                    <span class="topbar-user-name" sec:authorize="isAuthenticated()" sec:authentication="name">Admin</span>
                </div>
            </div>
        </header>

        <main class="admin-main">
            <div class="list-header">
                <div class="list-header-info">
                    <h2>
                        <i class="bi-bing"></i>
                        Lista porudžbina
                    </h2>
                    <p>Upravljanje porudžbinama</p>

                </div>
                <a th:href="@{/admin/orders/delete}" class="btn btn-danger p-3 shadow">
                    <i class="bi bi-bing"></i>
                    Obriši porudžbine
                </a>

            </div>


            <div class="products-table-container" th:if="${orders != null && !orders.isEmpty()}">
                <table class="products-table">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>Datum poručivanja</th>
                        <th>Broj proizvoda</th>
                        <th>Adresa</th>
                        <th>Akcije</th>
                    </tr>
                    </thead>
                    <tbody id="productsTableBody">
                    <tr th:each="order : ${orders}"
                        >
                        <td class="product-name-cell">
                            <span class="product-name" th:text="${order.id}"></span>
                            <span class="product-category" th:text="${order.status.getDisplayName}"></span>
                        </td>

                        <td>
                            <span th:text="${#temporals.format(order.orderDate, 'dd-MM-yyyy')}"></span>
                        </td>
                        <td>
                            <span th:text="${order.items.size()}"></span>
                        </td>
                        <td>
                            <span th:text="${order.shippingAddress}"></span>
                        </td>


                        <td>
                            <div class="product-actions">
                                <a th:href="@{/admin/orders/confirm(id=${order.id})}"
                                   class="btn-action btn-edit"
                                   title="Potvrdi">
                                    <i class="bi bi-check-all"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="empty-state" th:if="${orders == null || orders.isEmpty()}">
                <i class="bi bi-box-seam empty-icon"></i>
                <h3>Nema zabeleženih porudžbina</h3>

            </div>

            <div class="pagination-container" th:if="${orders != null && !orders.isEmpty()}">
                <div class="pagination-info">
                    Prikazano
                    <strong th:text="${(currentPage - 1) * pageSize + 1}">1</strong>
                    -
                    <strong th:text="${currentPage * pageSize > totalItems ? totalItems : currentPage * pageSize}">10</strong>
                    od
                    <strong th:text="${totalItems}">50</strong>
                    proizvoda
                </div>

                <div class="pagination-controls">
                    <a th:href="@{/admin/orders/list(page=${currentPage - 1}, pageSize=${pageSize})}"
                       th:classappend="${currentPage == 1 ? 'disabled' : ''}"
                       class="pagination-btn"
                       th:disabled="${currentPage == 1}">
                        <i class="bi bi-chevron-left"></i>
                    </a>

                    <th:block th:each="i : ${#numbers.sequence(1, totalPages)}">
                        <a th:if="${i == 1}"
                           th:href="@{/admin/orders/list(page=${i}, pageSize=${pageSize})}"
                           th:classappend="${currentPage == i ? 'active' : ''}"
                           class="pagination-btn"
                           th:text="${i}">1</a>

                        <span th:if="${i == 2 && currentPage > 3}" class="pagination-btn disabled">...</span>

                        <a th:if="${i > 1 && i < totalPages && i >= currentPage - 1 && i <= currentPage + 1}"
                           th:href="@{/admin/orders/list(page=${i}, pageSize=${pageSize})}"
                           th:classappend="${currentPage == i ? 'active' : ''}"
                           class="pagination-btn"
                           th:text="${i}">2</a>

                        <span th:if="${i == totalPages - 1 && currentPage < totalPages - 2}" class="pagination-btn disabled">...</span>

                        <a th:if="${i == totalPages && totalPages > 1}"
                           th:href="@{/admin/orders/list(page=${i}, pageSize=${pageSize})}"
                           th:classappend="${currentPage == i ? 'active' : ''}"
                           class="pagination-btn"
                           th:text="${i}">5</a>
                    </th:block>

                    <a th:href="@{/admin/orders/list(page=${currentPage + 1}, pageSize=${pageSize})}"
                       th:classappend="${currentPage == totalPages ? 'disabled' : ''}"
                       class="pagination-btn"
                       th:disabled="${currentPage == totalPages}">
                        <i class="bi bi-chevron-right"></i>
                    </a>
                </div>
            </div>
        </main>
    </div>
</div>

<div th:if="${successMessage != null}">
    <div class="cart-toast">
        <i class="bi bi-check-circle-fill"></i>
        <div class="toast-content">
            <h6>Uspešno!</h6>
            <p th:text="${successMessage}"></p>
        </div>
        <button class="btn-close-toast" onclick="this.parentElement.remove()">
            <i class="bi bi-x"></i>
        </button>
    </div>
</div>
<div th:if="${errorMessage != null}">
    <div class="cart-toast">
        <i class="bi bi-exclamation-octagon"></i>
        <div class="toast-content">
            <h6>Greška!</h6>
            <p th:text="${errorMessage}"></p>
        </div>
        <button class="btn-close-toast" onclick="this.parentElement.remove()">
            <i class="bi bi-x"></i>
        </button>
    </div>
</div>





<div class="mobile-overlay" id="mobileOverlay"></div>

<div th:replace="~{layouts/admin :: scripts}"></div>

<div th:if="${successMessage != null}">
    <div class="cart-toast">
        <i class="bi bi-check-circle-fill"></i>
        <div class="toast-content">
            <h6 class="text-success">Uspešno!</h6>
            <p th:text="${successMessage}"></p>
        </div>
        <button class="btn-close-toast" onclick="this.parentElement.remove()">
            <i class="bi bi-x"></i>
        </button>
    </div>
</div>

<div th:if="${errorMessage != null}">
    <div class="cart-toast text-danger">
        <i class="bi bi-exclamation-octagon text-danger"></i>
        <div class="toast-content text-danger">
            <h6 class="text-danger">Greška!</h6>
            <p th:text="${errorMessage}"></p>
        </div>
        <button class="btn-close-toast" onclick="this.parentElement.remove()">
            <i class="bi bi-x"></i>
        </button>
    </div>
</div>

<script>

    document.addEventListener('DOMContentLoaded', function() {
        const alerts = document.querySelectorAll('.alert');
        alerts.forEach(alert => {
            setTimeout(() => {
                alert.classList.add('fade');
                setTimeout(() => alert.remove(), 150);
            }, 5000);
        });
    });
</script>

</body>
</html>